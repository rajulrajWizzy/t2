# CoWorks API Reference

## Introduction
This document provides a comprehensive reference for all CoWorks API endpoints. The APIs are organized into two main categories:
1. **User APIs** - For regular users and customers
2. **Admin APIs** - For branch administrators and super administrators

## Authentication
All APIs (except authentication endpoints) require a valid JWT token in the Authorization header.

```
Authorization: Bearer <token>
```

You can obtain tokens for testing from the `tokens/access-tokens.json` file generated by the auth-fix script.

## Base URL
All API endpoints are relative to: `http://localhost:3000/api`

---

## User APIs

### Authentication

#### Register
- **URL**: `/auth/register`
- **Method**: `POST`
- **Description**: Register a new user account
- **Request Body**:
  ```json
  {
    "name": "User Name",
    "email": "user@example.com",
    "password": "SecurePassword123!"
  }
  ```
- **Response**: Returns the created user profile with token

#### Login
- **URL**: `/auth/login`
- **Method**: `POST`
- **Description**: Authenticate a user and get access token
- **Request Body**:
  ```json
  {
    "email": "user@example.com",
    "password": "SecurePassword123!"
  }
  ```
- **Response**: Returns the user profile with token

#### Forgot Password
- **URL**: `/auth/forgot-password`
- **Method**: `POST`
- **Description**: Send a password reset link to user's email
- **Request Body**:
  ```json
  {
    "email": "user@example.com"
  }
  ```
- **Response**: Confirmation message

#### Reset Password
- **URL**: `/auth/reset-password`
- **Method**: `POST`
- **Description**: Reset password using token from email
- **Request Body**:
  ```json
  {
    "token": "reset_token_from_email",
    "password": "NewSecurePassword123!"
  }
  ```
- **Response**: Confirmation message

#### Logout
- **URL**: `/auth/logout`
- **Method**: `POST`
- **Description**: Invalidate the current user token
- **Authentication**: Required
- **Response**: Logout confirmation

### User Profile

#### Get Profile
- **URL**: `/profile`
- **Method**: `GET`
- **Description**: Get the current user's profile information
- **Authentication**: Required
- **Response**: User profile data

#### Update Profile
- **URL**: `/profile`
- **Method**: `PUT`
- **Description**: Update the current user's profile information
- **Authentication**: Required
- **Request Body**:
  ```json
  {
    "name": "Updated Name",
    "email": "updated@example.com"
  }
  ```
- **Response**: Updated user profile

### Bookings

#### List Bookings
- **URL**: `/bookings`
- **Method**: `GET`
- **Description**: Get all bookings for the current user
- **Authentication**: Required
- **Parameters**:
  - `status` (optional): Filter by booking status (active, completed, cancelled)
  - `from_date` (optional): Start date for filtering
  - `to_date` (optional): End date for filtering
- **Response**: List of user bookings

#### Create Booking
- **URL**: `/bookings`
- **Method**: `POST`
- **Description**: Create a new booking
- **Authentication**: Required
- **Request Body**:
  ```json
  {
    "branch_id": 1,
    "seating_type_id": 1,
    "date": "2023-10-15",
    "start_time": "09:00",
    "end_time": "17:00"
  }
  ```
- **Response**: Created booking details

#### Get Booking
- **URL**: `/bookings/:id`
- **Method**: `GET`
- **Description**: Get details of a specific booking
- **Authentication**: Required
- **Parameters**:
  - `id`: Booking ID
- **Response**: Booking details

#### Update Booking
- **URL**: `/bookings/:id`
- **Method**: `PUT`
- **Description**: Update an existing booking
- **Authentication**: Required
- **Parameters**:
  - `id`: Booking ID
- **Request Body**: Updated booking data
- **Response**: Updated booking details

#### Cancel Booking
- **URL**: `/bookings/:id/cancel`
- **Method**: `POST`
- **Description**: Cancel an existing booking
- **Authentication**: Required
- **Parameters**:
  - `id`: Booking ID
- **Response**: Confirmation message

### Branches

#### List Branches
- **URL**: `/branches`
- **Method**: `GET`
- **Description**: Get all available branches
- **Authentication**: Required
- **Response**: List of branches with details

#### Get Branch
- **URL**: `/branches/:id`
- **Method**: `GET`
- **Description**: Get details of a specific branch
- **Authentication**: Required
- **Parameters**:
  - `id`: Branch ID
- **Response**: Branch details

### Seating Types

#### List Seating Types
- **URL**: `/seating-types`
- **Method**: `GET`
- **Description**: Get all available seating types
- **Authentication**: Required
- **Parameters**:
  - `branch_id` (optional): Filter by branch
- **Response**: List of seating types

#### Get Seating Type
- **URL**: `/seating-types/:id`
- **Method**: `GET`
- **Description**: Get details of a specific seating type
- **Authentication**: Required
- **Parameters**:
  - `id`: Seating Type ID
- **Response**: Seating type details

### Availability

#### Check Availability
- **URL**: `/availability`
- **Method**: `GET`
- **Description**: Check seat availability for a specific date and time
- **Authentication**: Required
- **Parameters**:
  - `branch_id`: Branch ID
  - `date`: Date to check
  - `start_time` (optional): Start time
  - `end_time` (optional): End time
  - `seating_type_id` (optional): Filter by seating type
- **Response**: Available seats and time slots

---

## Admin APIs

### Authentication

#### Admin Login
- **URL**: `/admin/auth/login`
- **Method**: `POST`
- **Description**: Authenticate as an admin user
- **Request Body**:
  ```json
  {
    "email": "admin@example.com",
    "password": "AdminPassword123!"
  }
  ```
- **Response**: Returns admin profile with token

### Admin Dashboard

#### Dashboard Stats
- **URL**: `/admin/dashboard/stats`
- **Method**: `GET`
- **Description**: Get dashboard statistics for branch admin or super admin
- **Authentication**: Admin required
- **Response**: Dashboard statistics including bookings counts, revenue, etc.

### Users Management

#### List Users
- **URL**: `/admin/users`
- **Method**: `GET`
- **Description**: Get all users (paginated)
- **Authentication**: Admin required
- **Parameters**:
  - `page` (optional): Page number
  - `limit` (optional): Items per page
  - `search` (optional): Search term
  - `status` (optional): Filter by user status
- **Response**: List of users with pagination

#### Get User
- **URL**: `/admin/users/:id`
- **Method**: `GET`
- **Description**: Get details of a specific user
- **Authentication**: Admin required
- **Parameters**:
  - `id`: User ID
- **Response**: User details

#### Create User
- **URL**: `/admin/users/create`
- **Method**: `POST`
- **Description**: Create a new user
- **Authentication**: Admin required
- **Request Body**:
  ```json
  {
    "name": "New User",
    "email": "newuser@example.com",
    "password": "SecurePassword123!",
    "role": "user"
  }
  ```
- **Response**: Created user details

#### Update User
- **URL**: `/admin/users/:id`
- **Method**: `PUT`
- **Description**: Update an existing user
- **Authentication**: Admin required
- **Parameters**:
  - `id`: User ID
- **Request Body**: Updated user data
- **Response**: Updated user details

#### Delete User
- **URL**: `/admin/users/:id`
- **Method**: `DELETE`
- **Description**: Delete a user
- **Authentication**: Admin required
- **Parameters**:
  - `id`: User ID
- **Response**: Confirmation message

### Bookings Management

#### List All Bookings
- **URL**: `/admin/bookings`
- **Method**: `GET`
- **Description**: Get all bookings (paginated)
- **Authentication**: Admin required
- **Parameters**:
  - `page` (optional): Page number
  - `limit` (optional): Items per page
  - `status` (optional): Filter by booking status
  - `user_id` (optional): Filter by user
  - `branch_id` (optional): Filter by branch
  - `from_date` (optional): Start date for filtering
  - `to_date` (optional): End date for filtering
- **Response**: List of bookings with pagination

#### Get Booking
- **URL**: `/admin/bookings/:id`
- **Method**: `GET`
- **Description**: Get details of a specific booking
- **Authentication**: Admin required
- **Parameters**:
  - `id`: Booking ID
- **Response**: Booking details

#### Update Booking
- **URL**: `/admin/bookings/:id`
- **Method**: `PUT`
- **Description**: Update an existing booking
- **Authentication**: Admin required
- **Parameters**:
  - `id`: Booking ID
- **Request Body**: Updated booking data
- **Response**: Updated booking details

#### Cancel Booking
- **URL**: `/admin/bookings/:id/cancel`
- **Method**: `POST`
- **Description**: Cancel an existing booking
- **Authentication**: Admin required
- **Parameters**:
  - `id`: Booking ID
- **Response**: Confirmation message

### Branch Management

#### List Branches
- **URL**: `/admin/branches`
- **Method**: `GET`
- **Description**: Get all branches
- **Authentication**: Admin required
- **Response**: List of branches

#### Create Branch
- **URL**: `/admin/branches`
- **Method**: `POST`
- **Description**: Create a new branch
- **Authentication**: Super Admin required
- **Request Body**:
  ```json
  {
    "name": "New Branch",
    "address": "123 Main St",
    "city": "Example City",
    "postal_code": "12345",
    "phone": "+1234567890",
    "email": "branch@example.com"
  }
  ```
- **Response**: Created branch details

#### Get Branch
- **URL**: `/admin/branches/:id`
- **Method**: `GET`
- **Description**: Get details of a specific branch
- **Authentication**: Admin required
- **Parameters**:
  - `id`: Branch ID
- **Response**: Branch details

#### Update Branch
- **URL**: `/admin/branches/:id`
- **Method**: `PUT`
- **Description**: Update an existing branch
- **Authentication**: Admin required
- **Parameters**:
  - `id`: Branch ID
- **Request Body**: Updated branch data
- **Response**: Updated branch details

#### Delete Branch
- **URL**: `/admin/branches/:id`
- **Method**: `DELETE`
- **Description**: Delete a branch
- **Authentication**: Super Admin required
- **Parameters**:
  - `id`: Branch ID
- **Response**: Confirmation message

### Seating Management

#### List Seating Types
- **URL**: `/admin/seating-types`
- **Method**: `GET`
- **Description**: Get all seating types
- **Authentication**: Admin required
- **Parameters**:
  - `branch_id` (optional): Filter by branch
- **Response**: List of seating types

#### Create Seating Type
- **URL**: `/admin/seating-types`
- **Method**: `POST`
- **Description**: Create a new seating type
- **Authentication**: Admin required
- **Request Body**:
  ```json
  {
    "name": "Premium Desk",
    "description": "Ergonomic desk with premium chair",
    "branch_id": 1,
    "price_hourly": 10,
    "price_daily": 50,
    "capacity": 20
  }
  ```
- **Response**: Created seating type details

#### Get Seating Type
- **URL**: `/admin/seating-types/:id`
- **Method**: `GET`
- **Description**: Get details of a specific seating type
- **Authentication**: Admin required
- **Parameters**:
  - `id`: Seating Type ID
- **Response**: Seating type details

#### Update Seating Type
- **URL**: `/admin/seating-types/:id`
- **Method**: `PUT`
- **Description**: Update an existing seating type
- **Authentication**: Admin required
- **Parameters**:
  - `id`: Seating Type ID
- **Request Body**: Updated seating type data
- **Response**: Updated seating type details

#### Delete Seating Type
- **URL**: `/admin/seating-types/:id`
- **Method**: `DELETE`
- **Description**: Delete a seating type
- **Authentication**: Admin required
- **Parameters**:
  - `id`: Seating Type ID
- **Response**: Confirmation message

### Reports

#### Bookings Report
- **URL**: `/admin/reports/bookings`
- **Method**: `GET`
- **Description**: Generate a bookings report
- **Authentication**: Admin required
- **Parameters**:
  - `from_date`: Start date
  - `to_date`: End date
  - `branch_id` (optional): Filter by branch
  - `format` (optional): Output format (json, csv, pdf)
- **Response**: Report data

#### Revenue Report
- **URL**: `/admin/reports/revenue`
- **Method**: `GET`
- **Description**: Generate a revenue report
- **Authentication**: Admin required
- **Parameters**:
  - `from_date`: Start date
  - `to_date`: End date
  - `branch_id` (optional): Filter by branch
  - `format` (optional): Output format (json, csv, pdf)
- **Response**: Report data

#### User Activity Report
- **URL**: `/admin/reports/user-activity`
- **Method**: `GET`
- **Description**: Generate a user activity report
- **Authentication**: Admin required
- **Parameters**:
  - `from_date`: Start date
  - `to_date`: End date
  - `user_id` (optional): Filter by user
  - `format` (optional): Output format (json, csv, pdf)
- **Response**: Report data

---

## Response Format

All API responses follow a standard format:

```json
{
  "success": true,
  "data": { 
    // Response data here
  },
  "message": "Success message"
}
```

For errors:

```json
{
  "success": false,
  "error": {
    "code": "ERROR_CODE",
    "message": "Error message"
  }
}
```

## Error Codes

Common error codes:

- `UNAUTHORIZED`: Authentication required or invalid
- `FORBIDDEN`: Insufficient permissions
- `NOT_FOUND`: Resource not found
- `VALIDATION_ERROR`: Invalid input data
- `SERVER_ERROR`: Internal server error

## Rate Limiting

APIs are rate-limited to 100 requests per minute per IP address. The response headers include rate limit information:

```
X-RateLimit-Limit: 100
X-RateLimit-Remaining: 99
X-RateLimit-Reset: 1605112725
```

## Testing

You can test these APIs using the generated Postman collection and tokens. See the API Testing guide for more information. 